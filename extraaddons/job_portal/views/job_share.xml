<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="job_share" name="Job Share">
        <t t-call="website.layout">
            <t t-set="head_title">Share Job - <t t-esc="job.name"/></t>
            
            <div class="container mt-5 mb-5">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="card shadow-sm border-0" style="border-radius: 12px;">
                            <div class="card-body p-3">
                                <!-- Header -->
                                <div class="text-center mb-4">
                                    <div class="d-inline-flex align-items-center justify-content-center mb-3" 
                                            style="width: 60px; height: 60px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%;">
                                        <i class="fa fa-share-alt" style="color: white; font-size: 24px;"></i>
                                    </div>
                                    <h3 class="mb-2" style="color: #2d3748; font-weight: 600;">Share This Job</h3>
                                    <p class="text-muted mb-0" style="font-size: 14px;">
                                        <t t-esc="job.name"/>
                                    </p>
                                </div>

                                <!-- Share Link Section -->
                                <div class="mb-4">
                                    <label class="form-label" style="color: #4a5568; font-weight: 500; font-size: 14px;">
                                        Copy Link
                                    </label>
                                    <div class="input-group" style="border-radius: 8px; overflow: hidden;">
                                        <input type="text" 
                                            class="form-control border-end-0" 
                                            t-att-value="share_url" 
                                            readonly="readonly"
                                            id="shareUrlInput"
                                            style="background-color: #f7fafc; border: 1px solid #e2e8f0; padding: 12px 16px; font-size: 14px;"/>
                                        <button class="btn" 
                                            onclick="copyLink()"
                                            style="background-color: #f7fafc; border: 1px solid #e2e8f0; border-left: 0; padding: 12px 20px;">
                                            <i class="fa fa-copy" style="color: #667eea;"></i>
                                        </button>
                                    </div>
                                    <small class="text-success d-none" id="copySuccess" style="font-size: 12px;">
                                        <i class="fa fa-check-circle"></i> Link copied to clipboard!
                                    </small>
                                </div>

                                <!-- Divider -->
                                <div class="d-flex align-items-center my-4">
                                    <div class="flex-grow-1" style="height: 1px; background-color: #e2e8f0;"></div>
                                    <span class="px-3 text-muted" style="font-size: 13px;">or share via</span>
                                    <div class="flex-grow-1" style="height: 1px; background-color: #e2e8f0;"></div>
                                </div>

                                <!-- Social Media Buttons -->
                                <div class="d-flex justify-content-center mb-4">
                                    <div class="d-flex flex-wrap">
                                        <a href="#" class="p-2 m-1" style="background-color: #fff; border: 1px solid #e7e7e7; border-radius: 8px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; text-decoration: none;" onclick="shareOnSocial('facebook')">
                                            <i class="fa fa-facebook" style="color: #3b5998; font-size: 22px;"></i>
                                        </a>
                                        <a href="#" class="p-2 m-1" style="background-color: #fff; border: 1px solid #e7e7e7; border-radius: 8px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; text-decoration: none;" onclick="shareOnSocial('twitter')">
                                            <i class="fa fa-twitter" style="color: #1da1f2; font-size: 22px;"></i>
                                        </a>
                                        <!-- <a href="#" class="p-2 m-1" style="background-color: #fff; border: 1px solid #e7e7e7; border-radius: 8px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; text-decoration: none;" onclick="shareOnSocial('instagram')">
                                            <i class="fa fa-instagram" style="color: #e1306c; font-size: 22px;"></i>
                                        </a> -->
                                        <a href="#" class="p-2 m-1" style="background-color: #fff; border: 1px solid #e7e7e7; border-radius: 8px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; text-decoration: none;" onclick="shareOnSocial('whatsapp')">
                                            <i class="fa fa-whatsapp" style="color: #25d366; font-size: 22px;"></i>
                                        </a>
                                        <a href="#" class="p-2 m-1" style="background-color: #fff; border: 1px solid #e7e7e7; border-radius: 8px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; text-decoration: none;" onclick="shareOnSocial('linkedin')">
                                            <i class="fa fa-linkedin" style="color: #0077b5; font-size: 22px;"></i>
                                        </a>
                                    </div>
                                </div>

                                <!-- Back Button -->
                                <div class="text-center mt-4">
                                    <a href="/all-jobs" class="btn btn-link text-muted" style="text-decoration: none; font-size: 14px;">
                                        <i class="fa fa-arrow-left"></i> Back to Jobs
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <style>
                .btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                }
                
                .input-group input:focus,
                .input-group button:focus {
                    outline: none;
                    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                }
                
                #shareUrlInput {
                    user-select: all; /* Make text easier to select */
                    -webkit-user-select: all;
                    -moz-user-select: all;
                }
                
                .copy-fallback {
                    background-color: #fff3cd !important;
                    border-color: #ffeaa7 !important;
                }
            </style>
            
            <script>
                <![CDATA[
                function copyLink() {
                    const input = document.getElementById('shareUrlInput');
                    const successMsg = document.getElementById('copySuccess');
                    
                    // Modern approach with Clipboard API
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(input.value).then(function() {
                            successMsg.classList.remove('d-none');
                            setTimeout(function() {
                                successMsg.classList.add('d-none');
                            }, 3000);
                        }).catch(function(err) {
                            console.error('Clipboard API failed:', err);
                            fallbackCopy(input, successMsg);
                        });
                    } else {
                        // Fallback for older browsers
                        fallbackCopy(input, successMsg);
                    }
                }
                
                function fallbackCopy(input, successMsg) {
                    try {
                        input.select();
                        input.setSelectionRange(0, 99999); // For mobile devices
                        
                        if (document.execCommand && document.execCommand('copy')) {
                            successMsg.classList.remove('d-none');
                            setTimeout(function() {
                                successMsg.classList.add('d-none');
                            }, 3000);
                        } else {
                            // Last resort: show the input for manual copying
                            input.style.display = 'block';
                            input.focus();
                            input.select();
                            alert('Please copy the link manually: ' + input.value);
                        }
                    } catch (err) {
                        console.error('Copy failed:', err);
                        alert('Please copy the link manually: ' + input.value);
                    }
                }
                
                function shareOnSocial(platform) {
                    const url = document.getElementById('shareUrlInput').value;
                    const jobTitle = document.querySelector('.text-muted').textContent.trim();
                    const shareText = `Check out this job opportunity: ${jobTitle}`;
                    
                    const shareUrls = {
                        facebook: `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`,
                        twitter: `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(url)}`,
                        linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`,
                        whatsapp: `https://wa.me/?text=${encodeURIComponent(shareText + ' ' + url)}`,
                        email: `mailto:?subject=${encodeURIComponent(jobTitle)}&body=${encodeURIComponent(shareText + '\n\n' + url)}`
                    };
                    
                    if (platform === 'email') {
                        window.location.href = shareUrls[platform];
                    } else {
                        window.open(shareUrls[platform], '_blank', 'width=600,height=400');
                    }
                }
                ]]>
            </script>
        </t>
    </template>
</odoo>